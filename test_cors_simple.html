<!DOCTYPE html>
<html>
<head>
    <title>CORS Test</title>
</head>
<body>
    <h1>CORS Test Page</h1>
    <div id="results"></div>
    
    <script>
        // Change this to your actual backend URL
        const API_URL = 'http://localhost:50000';  // Change to your domain
        
        const results = document.getElementById('results');
        
        async function testCORS() {
            results.innerHTML = '<h2>Testing CORS...</h2>';
            
            // Test 1: OPTIONS request (preflight)
            try {
                results.innerHTML += '<p>Testing OPTIONS request...</p>';
                const optionsResponse = await fetch(`${API_URL}/api/v1/health`, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'Content-Type'
                    }
                });
                results.innerHTML += `<p style="color: green;">✓ OPTIONS request: ${optionsResponse.status}</p>`;
            } catch (error) {
                results.innerHTML += `<p style="color: red;">✗ OPTIONS request failed: ${error.message}</p>`;
            }
            
            // Test 2: GET request
            try {
                results.innerHTML += '<p>Testing GET request...</p>';
                const getResponse = await fetch(`${API_URL}/api/v1/health`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include'
                });
                const data = await getResponse.json();
                results.innerHTML += `<p style="color: green;">✓ GET request successful: ${JSON.stringify(data)}</p>`;
            } catch (error) {
                results.innerHTML += `<p style="color: red;">✗ GET request failed: ${error.message}</p>`;
            }
            
            // Test 3: POST request (login)
            try {
                results.innerHTML += '<p>Testing POST request (login)...</p>';
                const formData = new URLSearchParams();
                formData.append('username', 'admin@test.com');
                formData.append('password', 'admin123');
                
                const postResponse = await fetch(`${API_URL}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: formData,
                    credentials: 'include'
                });
                
                if (postResponse.ok) {
                    const data = await postResponse.json();
                    results.innerHTML += `<p style="color: green;">✓ POST request successful (token received)</p>`;
                } else {
                    results.innerHTML += `<p style="color: orange;">⚠ POST request returned ${postResponse.status}</p>`;
                }
            } catch (error) {
                results.innerHTML += `<p style="color: red;">✗ POST request failed: ${error.message}</p>`;
            }
            
            results.innerHTML += '<h3>Test Complete!</h3>';
            results.innerHTML += '<p>Check browser console for detailed error messages.</p>';
        }
        
        // Run test when page loads
        testCORS();
    </script>
</body>
</html>